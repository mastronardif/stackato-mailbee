<html><head><title>Perl::Critic::Policy::RegularExpressions::ProhibitComplexRegexes - Split long regexps into smaller qr// chunks.</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.012001 at Wed Apr 13 00:04:29 2011 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#AFFILIATION'>AFFILIATION</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CASE_STUDY'>CASE STUDY</a>
  <li class='indexItem indexItem1'><a href='#CONFIGURATION'>CONFIGURATION</a>
  <li class='indexItem indexItem1'><a href='#CREDITS'>CREDITS</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT'>COPYRIGHT</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Perl::Critic::Policy::RegularExpressions::ProhibitComplexRegexes - Split long regexps into smaller <code>qr//</code> chunks.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AFFILIATION"
>AFFILIATION</a></h1>

<p>This Policy is part of the core <a href="../../../../Perl/Critic.html" class="podlinkpod"
>Perl::Critic</a> distribution.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Big regexps are hard to read,
perhaps even the hardest part of Perl.
A good practice to write digestible chunks of regexp and put them together.
This policy flags any regexp that is longer than <code>N</code> characters,
where <code>N</code> is a configurable value that defaults to 60.
If the regexp uses the <code>x</code> flag,
then the length is computed after parsing out any comments or whitespace.</p>

<p>Unfortunately the use of descriptive (and therefore longish) variable names can cause regexps to be in violation of this policy,
so interpolated variables are counted as 4 characters no matter how long their names actually are.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CASE_STUDY"
>CASE STUDY</a></h1>

<p>As an example,
look at the regexp used to match email addresses in <a href="../../../../Email/Valid/Loose.html" class="podlinkpod"
>Email::Valid::Loose</a> (tweaked lightly to wrap for POD)</p>

<pre>    (?x-ism:(?:[^(\040)&#60;&#62;@,;:&#34;.\\\[\]\000-\037\x80-\xff]+(?![^(\040)&#60;&#62;@,;:&#34;.\\\[\]
    \000-\037\x80-\xff])|&#34;[^\\\x80-\xff\n\015&#34;]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015
    &#34;]*)*&#34;)(?:(?:[^(\040)&#60;&#62;@,;:&#34;.\\\[\]\000-\037\x80-\xff]+(?![^(\040)&#60;&#62;@,;:&#34;.\\\[
    \]\000-\037\x80-\xff])|&#34;[^\\\x80-\xff\n\015&#34;]*(?:\\[^\x80-\xff][^\\\x80-\xff\n
    \015&#34;]*)*&#34;)|\.)*\@(?:[^(\040)&#60;&#62;@,;:&#34;.\\\[\]\000-\037\x80-\xff]+(?![^(\040)&#60;&#62;@,
    ;:&#34;.\\\[\]\000-\037\x80-\xff])|\[(?:[^\\\x80-\xff\n\015\[\]]|\\[^\x80-\xff])*\]
    )(?:\.(?:[^(\040)&#60;&#62;@,;:&#34;.\\\[\]\000-\037\x80-\xff]+(?![^(\040)&#60;&#62;@,;:&#34;.\\\[\]\000
    -\037\x80-\xff])|\[(?:[^\\\x80-\xff\n\015\[\]]|\\[^\x80-\xff])*\]))*)</pre>

<p>which is constructed from the following code:</p>

<pre>    my $esc         = &#39;\\\\&#39;;
    my $period      = &#39;\.&#39;;
    my $space       = &#39;\040&#39;;
    my $open_br     = &#39;\[&#39;;
    my $close_br    = &#39;\]&#39;;
    my $nonASCII    = &#39;\x80-\xff&#39;;
    my $ctrl        = &#39;\000-\037&#39;;
    my $cr_list     = &#39;\n\015&#39;;
    my $qtext       = qq/[^$esc$nonASCII$cr_list\&#34;]/; # &#34;
    my $dtext       = qq/[^$esc$nonASCII$cr_list$open_br$close_br]/;
    my $quoted_pair = qq&#60;$esc&#62;.qq&#60;[^$nonASCII]&#62;;
    my $atom_char   = qq/[^($space)&#60;&#62;\@,;:\&#34;.$esc$open_br$close_br$ctrl$nonASCII]/;# &#34;
    my $atom        = qq&#60;$atom_char+(?!$atom_char)&#62;;
    my $quoted_str  = qq&#60;\&#34;$qtext*(?:$quoted_pair$qtext*)*\&#34;&#62;; # &#34;
    my $word        = qq&#60;(?:$atom|$quoted_str)&#62;;
    my $domain_ref  = $atom;
    my $domain_lit  = qq&#60;$open_br(?:$dtext|$quoted_pair)*$close_br&#62;;
    my $sub_domain  = qq&#60;(?:$domain_ref|$domain_lit)&#62;;
    my $domain      = qq&#60;$sub_domain(?:$period$sub_domain)*&#62;;
    my $local_part  = qq&#60;$word(?:$word|$period)*&#62;; # This part is modified
    $Addr_spec_re   = qr&#60;$local_part\@$domain&#62;;</pre>

<p>If you read the code from bottom to top, it is quite readable. And, you can even see the one violation of RFC822 that Tatsuhiko Miyagawa deliberately put into Email::Valid::Loose to allow periods. Look for the <code>|\.</code> in the upper regexp to see that same deviation.</p>

<p>One could certainly argue that the top regexp could be re-written more legibly with <code>m//x</code> and comments. But the bottom version is self-documenting and, for example, doesn&#39;t repeat <code>\x80-\xff</code> 18 times. Furthermore, it&#39;s much easier to compare the second version against the source BNF grammar in RFC 822 to judge whether the implementation is sound even before running tests.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIGURATION"
>CONFIGURATION</a></h1>

<p>This policy allows regexps up to <code>N</code> characters long, where <code>N</code> defaults to 60. You can override this to set it to a different number with the <code>max_characters</code> setting. To do this, put entries in a <em>.perlcriticrc</em> file like this:</p>

<pre>    [RegularExpressions::ProhibitComplexRegexes]
    max_characters = 40</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CREDITS"
>CREDITS</a></h1>

<p>Initial development of this policy was supported by a grant from the Perl Foundation.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Chris Dolan &#60;cdolan@cpan.org&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright (c) 2007-2011 Chris Dolan. Many rights reserved.</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself. The full text of this license can be found in the LICENSE file included with this module</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
